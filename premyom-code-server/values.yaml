vscode-python:
  # Nécessaire si Harbor est privé: crée le secret docker-registry côté cluster
  # puis référence-le ici (format Kubernetes standard).
  #
  # Exemple:
  # kubectl -n onyxia create secret docker-registry harbor-regcred \
  #   --docker-server=harbor.lan \
  #   --docker-username='robot$<name>' \
  #   --docker-password='<token>' \
  #   --docker-email='none'
  imagePullSecrets:
    - name: harbor-regcred

  ingress:
    enabled: false

  service:
    image:
      pullPolicy: IfNotPresent
      custom:
        enabled: true
        version: harbor.lan/premyom/onyxia-code-server:0.1.4

  extraEnvVars:
    - name: CODE_SERVER_AUTH
      value: none
    - name: ONYXIA_USER_GROUPS
      value: '{{- $p := (default dict .premyom) -}}{{- default "[]" $p.userGroupsJson -}}'
    - name: PREMYOM_S3_MOUNT_ENABLED
      value: '{{- $p := (default dict .premyom) -}}{{- $s3 := (default dict $p.s3Mount) -}}{{- default "false" $s3.enabled -}}'
    - name: PREMYOM_S3_NONHDS_ENDPOINT_HOST
      value: '{{- $p := (default dict .premyom) -}}{{- $s3 := (default dict $p.s3Mount) -}}{{- default "" $s3.nonHdsEndpointHost -}}'
    - name: PREMYOM_S3_HDS_ENDPOINT_HOST
      value: '{{- $p := (default dict .premyom) -}}{{- $s3 := (default dict $p.s3Mount) -}}{{- default "" $s3.hdsEndpointHost -}}'
    - name: PREMYOM_S3_VAULT_NONHDS_PATH
      value: '{{- $p := (default dict .premyom) -}}{{- $s3 := (default dict $p.s3Mount) -}}{{- default "" $s3.vaultNonHdsPath -}}'
    - name: PREMYOM_S3_VAULT_HDS_PATH
      value: '{{- $p := (default dict .premyom) -}}{{- $s3 := (default dict $p.s3Mount) -}}{{- default "" $s3.vaultHdsPath -}}'
    - name: PREMYOM_S3_MOUNT_ROOT
      value: '{{- $p := (default dict .premyom) -}}{{- $s3 := (default dict $p.s3Mount) -}}{{- default "/mnt/s3" $s3.mountRoot -}}'

  # s3fs en pod Kubernetes nécessite FUSE: /dev/fuse + droits.
  # Pour la démo, on assume un pod privilégié.
  premyomS3fs:
    enabled: true

  securityContext:
    privileged: true
    allowPrivilegeEscalation: true
    runAsUser: 0
    runAsGroup: 0
    capabilities:
      add:
        - SYS_ADMIN

  persistence:
    size: 2Gi

  resources:
    limits:
      cpu: "2"
      memory: 4Gi
    requests:
      cpu: "1"
      memory: 2Gi

  vault:
    enabled: true
    # Secret Kubernetes (namespace onyxia) contenant VAULT_ADDR et VAULT_TOKEN
    # (token avec accès read-only sur secret/data/premyom/s3/*).
    secretName: "premyom-vault-read"
    token: ""
    url: ""
    mount: ""
    secret: ""
    directory: ""

  premyom:
    userGroupsJson: "[]"
    s3Mount:
      enabled: "true"
      nonHdsEndpointHost: "cellar-c2.services.clever-cloud.com"
      hdsEndpointHost: "cellar-c2.services.clever-cloud.com"
      vaultNonHdsPath: "secret/data/premyom/s3/nonhds"
      vaultHdsPath: "secret/data/premyom/s3/hds"
      mountRoot: "/mnt/s3"

sso:
  secretName: oauth2-proxy
  issuerUrl: https://auth.datalab.arkam-group.com/auth/realms/onyxia
  redirectUrl: https://datalab.arkam-group.com/oauth2/callback
  cookieDomain: .datalab.arkam-group.com
  whitelistDomain: .datalab.arkam-group.com
  ingress:
    enabled: true
    tls: true
    ingressClassName: ""
    annotations: {}
    hostname: chart-example.local
    path: /
