image:
  repository: harbor.lan/premyom/onyxia-s3-explorer
  tag: 0.1.6
  pullPolicy: IfNotPresent

imagePullSecrets:
  - name: harbor-regcred

# s3fs en pod Kubernetes nécessite FUSE: /dev/fuse + droits.
securityContext:
  privileged: true
  allowPrivilegeEscalation: true
  runAsUser: 0
  runAsGroup: 0
  capabilities:
    add:
      - SYS_ADMIN

resources:
  limits:
    cpu: "1"
    memory: 2Gi
  requests:
    cpu: "0.2"
    memory: 256Mi

# Vault (optionnel): laisse par défaut pour Arkam.
extraVault:
  addr: "http://vault.vault.svc.cluster.local:8200"
  k8sRole: "premyom-s3-read"

# Variables d'environnement additionnelles (optionnel).
# Les variables Premyom (Vault + S3 + groupes) sont définies directement dans le template Helm.
extraEnvVars: []

premyom:
  # Array attendu (x-onyxia: overwriteDefaultWith user.decodedIdToken.groups).
  # Le template convertit en JSON via `toJson`.
  userGroupsJson: []
  s3Mount:
    enabled: "true"
    nonHdsEndpointHost: "cellar-c2.services.clever-cloud.com"
    hdsEndpointHost: "cellar-c2.services.clever-cloud.com"
    vaultNonHdsPath: "secret/data/premyom/s3/nonhds"
    vaultHdsPath: "secret/data/premyom/s3/hds"
    mountRoot: "/mnt/s3"

sso:
  # SSO peut être géré de 2 façons :
  # - forwardAuth : s'appuie sur le oauth2-proxy central via middleware Traefik.
  # - embedded : déploie un oauth2-proxy par service.
  #
  # En embedded, le callback OIDC est sur le même host que le service:
  #   https://single-project-<id>-0.datalab.arkam-group.com/oauth2/callback
  # => côté Keycloak, prévoir:
  #   https://*.datalab.arkam-group.com/oauth2/callback
  mode: embedded
  forwardAuth:
    middleware: onyxia-workspace-sso-chain@kubernetescrd

  secretName: oauth2-proxy
  issuerUrl: https://auth.datalab.arkam-group.com/auth/realms/onyxia
  # DEPRECATED (compatibilité): n'est plus utilisé.
  centralHost: datalab.arkam-group.com
  # Optionnel: override du redirect URL oauth2-proxy (sinon oauth2-proxy déduit l'URL depuis la requête).
  redirectUrl: ""
  cookieDomain: .datalab.arkam-group.com
  whitelistDomain: .datalab.arkam-group.com
  ingress:
    enabled: true
    tls: true
    ingressClassName: ""
    annotations:
      kubernetes.io/ingress.class: arkam-traefik
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
      traefik.ingress.kubernetes.io/router.tls: "true"
      traefik.ingress.kubernetes.io/router.tls.certresolver: le
    hostname: chart-example.local
    path: /
